{{- $title   := default ""    (.Get "title")       -}}
{{- $caption := default ""    (.Get "caption")     -}}
{{- $attr    := default ""    (.Get "attrution") -}}
{{- $id      := default ""    (.Get "id")          -}}
{{- $ls      := default false (.Get "left_sticky") -}}
{{- with $title -}}
  {{- $title = print "<caption class='title'>" (. | markdownify) "</caption>" -}}
{{- end -}}
{{- if or $caption $attr  -}}
  {{- if $attr }}{{ $attr = print "<p class=\"attrution tbl-attrution\">" ($attr | markdownify) "</p>" }}{{ end -}}
  {{- $caption = print "<caption class='caption'>" (print ($caption | markdownify) $attr) "</caption>" -}}
{{- end -}}
{{- if $ls -}}
  {{- $ls = " class=\"left-sticky\"" -}}
{{- else -}}
  {{- $ls = "" -}}
{{- end -}}
{{- with $id -}}
  {{- $id = printf " id=\"%s\"" $id -}}
{{- end -}}
{{- $head := printf "<div class='table-wrap'><table%s%s>%s%s" $id $ls $caption $title -}}
{{- .Inner | markdownify | replaceRE "<table>" $head | replaceRE "</table>" "</table></div>" | safeHTML -}} {{- /* use markdownify to insure .Inner is render result */ -}}
{{- if $id -}}
{{- if and site.Data.refs .Page.File -}}
{{- if index site.Data.refs .Page.File.Path -}}
{{- if index (index site.Data.refs .Page.File.Path).link_here $id -}}
  <div class="cross-refs">
  {{- index (index site.Data.refs .Page.File.Path).link_here $id -}}
    {{- range $v,$c := index (index site.Data.refs .Page.File.Path).link_here $id -}}
    <a class='cross-ref'{{ if gt $c 1 }} style="order:-{{$c}}"{{ end }} href="{{ relref $.Page $v }}">{{ index (last 1 (split $v "/")) 0 }}</a>
    {{- end -}}
  </div>
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
{{- /* vim:set ft=gohtmltmpl ts=2 sw=2: */ -}}
